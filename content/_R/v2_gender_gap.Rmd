---
author: "The Data Curious"
date: "10/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
opts_knit$set(root.dir = "/mnt/c/Users/User/Downloads")
```
# In countries that are more gender-equal, are women less likely to be in STEM?

That's what psychologists Gijsbert Stoet, at Leeds Beckett University, and David Geary, at the University of Missouri, found in their 2018 [study](http://journals.sagepub.com/doi/abs/10.1177/0956797617741719?journalCode=pssa). They also found that girls performed similarly to or better than boys in science in two of every three countries.

We will recreate their scatterplot of countries based on 1) the number of female STEM graduates and 2) the Gender Gap Index score, a measure of gender equality by the World Economic Forum. Let's also design the chart to show the countries' GDP per capita and geographical groups to see if any patterns emerge.

![Scatterplot from the study](https://cdn.theatlantic.com/assets/media/img/posts/2018/02/Screen_Shot_2018_02_16_at_12.33.16_PM/d099fa13a.png)

## Gather the data

In summary, the Gender Gap Index measures the level of gender equality across four dimensions: Economic Participation and Opportunity, Educational Attainment, Health and Survival, and Political Empowerment. The higher the score, the better a country is performing on that index.

Get the Index data. It's from a World Economic Forum report (in pdf!) but fortunately, it's also available in csv format, courtesy of the World Bank. The csv data was only up to 2016 when accessed but it'll do. Go to the [World Bank webpage](https://tcdata360.worldbank.org/indicators/af52ebe9?country=BRA&indicator=27962&viz=line_chart&years=2006,2016#) to download the data.


```{r}
# install.packages("dplyr") if not yet installed
library(dplyr)
library(tidyr)
genderindex <- read.csv("data.csv") # Read in Gender Gap Index data
```

Data on percentage of female STEM graduates can be found at [UNESCO's data portal on education](http://data.uis.unesco.org/Index.aspx?DataSetCode=EDULIT_DS). In the left tab, select *Completion* > *Percentage of tertiary graduates* > *Percentage of female graduates by field of study*. 

Customise selection to *Percentage of graduates from Science, Technology , Engineering and Mathematics programmes in tertiary education who are female (%)* and load the data.

```{r}
femSTEM <- read.csv("EDULIT_DS_06102018112127863.csv") # Read in STEM percentage data. The file name will differ based on the date/time of loading.
```

Data on countries' GDP per capita (current US dollars) can be found at [another World Bank webpage](http://api.worldbank.org/v2/en/indicator/NY.GDP.PCAP.CD?downloadformat=csv)

The link loads a zipped folder but we can use the *unzip* function.

```{r , echo = FALSE}
zipF <- "/mnt/c/Users/User/Downloads/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_10134337.zip" # saves the file path
outDir <- "/mnt/c/Users/User/Downloads/" # Indicate folder where the zip file should be unzipped to
unzip(zipF, exdir = outDir)
```

The unzipped content includes some metadata files but only the main file is of interest.

```{r}
GDPcapita <- read.csv("API_NY.GDP.PCAP.CD_DS2_en_csv_v2_10134337.csv", skip = 4) # Read in countries' GDP per capita data
```

For regional groupings, we will refer to the UN Statistics Division's [methodology](https://unstats.un.org/unsd/methodology/m49/overview/#). Click on the *language* tab of choice for options to load the data.

```{r}
geogrp <- read.csv("UNSD — Methodology.csv") # Read in regional groupings data
```

## Preview and clean the data

A quick look at *genderindex* shows that besides the Gender Gap Index, subindices that compose this overall index are also included in the dataset. We're only interested in countries' overall index scores so we'll create a new dataframe with the relevant subset in a series of steps.

```{r}
str(genderindex) 
genderindex2 <- genderindex %>% gather(Year, Score, X2006:X2016) %>% subset(Indicator == "Overall Global Gender Gap Index" & Subindicator.Type == "Index")  #Reshape the data from 'wide' to 'long' form and select rows that meet conditions
genderindex2 <- genderindex2[, c("Country.Name", "Country.ISO3","Year","Score")] #Keep only columns of interest
genderindex2 <- rename(genderindex2, Country = Country.Name, Code = Country.ISO3) # Rename  variables to keep things tidier
genderindex2$Year <- sub("^.","",genderindex2$Year) # Use regrex to remove the 'x' in front of the year
```
We will do the same for *femSTEM*.

```{r}
str(femSTEM)
femSTEM2 <- femSTEM[, c("LOCATION", "Country", "Time", "Value")]
femSTEM2 <- rename(femSTEM2, Code = LOCATION, Year = Time, PercentageFemGrad = Value)
femSTEM2$Year <- as.character.Date(femSTEM2$Year)
```

Likewise for GDPcapita... 

```{r}
str(GDPcapita)
GDPcapita2 <- GDPcapita %>% gather(Year, GDPcapitaUSD, X1960:X2017) %>%  rename(Country = Country.Name, Code = Country.Code)
GDPcapita2 <- GDPcapita2[, c("Country", "Code", "GDPcapitaUSD","Year")]
GDPcapita2$Year <- sub("^.","",GDPcapita2$Year) # Use regrex to remove the 'x' in front of the year
```
...as well as for geogrp. It looks like no change is required except a little renaming for consistency.

```{r}
str(geogrp)
geogrp <- rename(geogrp, Code = ISO.alpha3.Code)
```
The latest data we downloaded on the Gender Gap Index was for 2016 so let's try to merge the datasets for that year. A check on the available data for 2016 indicate we should ideally have 85 matches. However, we only got 80 matches.

```{r}
femSTEM3 <- femSTEM2 %>% subset(Year == "2016") %>% na.omit(femSTEM2)
genderindex3 <- genderindex2 %>% subset(Year == "2016") %>% na.omit(genderindex2)
nrow(femSTEM3)
nrow(genderindex3)
combined <- merge(femSTEM3, genderindex3, by = "Code")
nrow(combined)
```

Use the *merge* function again to identify the countries that got dropped (i.e. Gender Gap Index did not have data on these countries, at least for the year 2016).

```{r}
test <- merge(femSTEM3, combined, by = "Code", all.x = TRUE)
test <- subset(test, is.na(Score))
test$Country
```
```{r}
GDPcapita3 <- subset(GDPcapita2, Year == "2016" & !is.na(GDPcapitaUSD))
combined2 <- Reduce(function(...) merge(..., by= c("Code")), list(femSTEM3, genderindex3,GDPcapita3,geogrp)) #Use Reduce function to merge more than 2 dataframes simultaneously
```

## Visualise the data

Let's start with a basic scatterplot. This [ggplot tutorial](http://t-redactyl.io/blog/2016/02/creating-plots-in-r-using-ggplot2-part-6-weighted-scatterplots.html) by Jodie Burchell and Mauricio Vargas Sepúlveda is a major help.

```{r}
library(ggplot2)
p <- ggplot(combined2, aes(x= PercentageFemGrad, y =Score)) + geom_point()
p
```
Let's weigh the points with the GDPcapitaUSD variable and change their shape to circles.

```{r}
p <- ggplot(combined2, aes(x= PercentageFemGrad, y =Score, size = GDPcapitaUSD)) + geom_point(shape = 21)
p
```

Usually it's a good idea to have both axes begin at 0. Let's see what happens if we force the origin to start at 0.

```{r}
test_p <- p + expand_limits(x = 0, y = 0)
test_p
```

It's harder to see what's going on so we'll retain the earlier 'zoomed in' version of the plot. Let's see if there's any regional trend by basing the colour fill of the circles on the *Sub.region.Name* variable.

```{r}
p <- ggplot(combined2, aes(x= PercentageFemGrad, y =Score, size = GDPcapitaUSD, fill = Sub.region.Name)) + geom_point(shape = 21, alpha = 0.5)
#Add fill according to Sub.region.Name variable and adjust transparency of circles' fill 
p
```

It's not so easy to tell the regions apart so let's adjust the colours manually.

```{r}

fill = c("Australia and New Zealand" = "#b4a8ab","Northern Africa" ="#f4d16a","Sub-Saharan Africa" = "#fb7810", "Latin America and the Caribbean" = "#0ca82e","Northern America" = "#b1e632" ,"Eastern Europe" = "#7aa0d3","Southern Europe" ="#72c8b8","Northern Europe" = "#35618f", "Western Europe" ="#35c8ef", "Central Asia" = "#8a1c12", "Eastern Asia" ="#8f68ff", "South-eastern Asia" = "#fd95e8", "Southern Asia" = "#e38473", "Western Asia" ="#eb1241")
p <- p + scale_fill_manual(values = fill)
p
```

For the finishing touches, we will edit the sizes, labels, and background themes.


```{r}
p <- ggplot(combined2, aes(x= PercentageFemGrad, y =Score, size = GDPcapitaUSD, fill = Sub.region.Name)) + geom_point(shape = 21, alpha = 0.5) + scale_size_continuous(range = c(1, 10)) +
  #Adjusts the range of the minimum and maximum point size 
  geom_text(data = subset(combined2, PercentageFemGrad > 50 | Score > 0.8 ), aes(label = Country.x), family = "Georgia", size = 2 , nudge_x = 0.01, nudge_y = -0.015) +
  #Labels data points for countries where percentage of female gradutes in STEM is more than 50% or score in Gender Gap index is greater than 0.8. Adjusts positions of labels.
  theme_bw() +
  theme() +
  ggtitle("In more gender-equal countries, are women less likely to be in STEM?")+
  labs(x = "Percentage of women among STEM college graduates", y ="Gender Gap Index score", size = "GDP per capita (current US$)", fill = "Sub-regions")+
  scale_fill_manual(values = fill)+
    theme(legend.position = "bottom", legend.direction = "horizontal",
              legend.box = "vertical",
              legend.key.size = unit(0.5, "cm"),
              plot.title = element_text(family="Georgia", size =11),
              text = element_text(family = "Georgia"),
              axis.title = element_text(size = 8),
              legend.text = element_text(size = 8),
              legend.title=element_text(face = "bold", size = 8))
p

```


## Some observations and thoughts

From the scatterplot, it's clear that Northern European countries, particularly, those in Scandinavia, gravitate towards a higher Gender Gap Index score and lower percentage of female STEM graduates while the inverse is true for West Asian countries (which include the Middle East).

In the study, Stoet and Geary (the authors ) state that "life-quality pressures" in less gender-equal countries may be at play for a higher proportion of female engagement with STEM, suggesting that women may simply be less interested in STEM if they have a choice. Adam Mastroianni and Dakota McCoy posted on the [Scientific American blog](https://blogs.scientificamerican.com/voices/countries-with-less-gender-equity-have-more-women-in-stem-huh/) that they disagree. For them, the answer had to do with (discriminatory) cultural attitudes toward women in STEM. 

I'm more inclined towards the latter view, and I think that in countries with greater gender inequality, there is less difference in the extent of cultural biases that women face being in STEM versus non-STEM. This, in turn, results in less of a barrier for women entering STEM.

Back to the scatterplot, here's another interesting point: While a good number of countries that perform better on the Gender Gap Index tend to be wealthier as denoted by larger bubble sizes, there are much poorer countries performing just as well. These countries are from Sub-Saharan Africa.

Feel free to check out my Tableau version of the scatterplot [here](https://public.tableau.com/profile/alexandra2756#!/vizhome/Gender_gap_in_STEM/Dashboard1).